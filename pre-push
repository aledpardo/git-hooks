#!/usr/bin/env python

#
# Python script that implements a Git Hook of type Pre Push
# Author: Alexandre Pardo
# Date: 06/26/2019
#

import json, os, re, sys
from subprocess import check_call

print '==================================='
print '  GIT PRE-PUSH HOOK FOR LINT/TEST'
print '==================================='

try:
	packageJsonFileName = 'package.json'	
	isNpmProject = os.path.isfile(packageJsonFileName)

	if not isNpmProject:
		# Nothing to do
		sys.exit(0)

	packageJsonContent = open(packageJsonFileName).read()
	packageJson = json.loads(packageJsonContent)

	scripts = packageJson['scripts']

	hasLint = 'lint' in scripts
	if hasLint:
		check_call('npm run lint', shell=True)

	hasTest = 'test' in scripts
	if hasTest:
		check_call('npm run test', shell=True)
except Exception as e:
	# Oops, either lint or test failed.
	print 'EXCEPTION THROWN ON PRE-PUSH HOOK', e
	sys.exit(1)
